/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,n(o.key),o)}}function n(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}var r=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=e},n=[{key:"data",get:function(){return{name:this.name,about:this.about,avatar:this.avatar,_id:this._id,cohort:this.cohort}},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.name,n=t.about,r=t.avatar,o=t._id,i=t.cohort;Object.assign(this,{name:e,about:n,avatar:r,_id:o,cohort:i})}}],n&&e(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}(),o=document.querySelector("#card-template").content,i=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.onShow,i=n.onDelete,c=n.onLike,a=o.querySelector(".places__item.card").cloneNode(!0);if(a){a.dataset.cardId=t._id;var u=a.querySelector(".card__image");u&&(u.src=t.link,u.alt=t.name,u.addEventListener("click",(function(){r(t)}))),a.querySelector(".card__title").textContent=t.name;var s=a.querySelector(".card__delete-button");s&&e&&(t.owner._id===e?s.addEventListener("click",(function(){i(t._id)}),{once:!0}):s.remove());var l=a.querySelector(".card__like-button"),d=a.querySelector(".card__like-count");l&&l.addEventListener("click",(function(){c(t._id,!l.classList.contains("card__like-button_is-active")).then((function(t){!function(t){t&&t.classList.toggle("card__like-button_is-active")}(l),d.textContent=t})).catch((function(t){console.log("Ошибка like/dislike карточки: ",t)}))})),t.likes&&Array.isArray(t.likes)&&(t.likes.some((function(t){return t._id===e}))&&l.classList.add("card__like-button_is-active"),d&&(d.textContent=t.likes.length))}return a},c="popup_is-opened";function a(t){t&&t.classList.contains("popup")&&(document.addEventListener("keydown",u),t.classList.add(c))}function u(t){if("Escape"===t.key){var e=document.querySelectorAll(".popup");e&&s(Array.from(e).find((function(t){if(t&&t.classList.contains("popup_is-opened"))return t})))}}function s(t){t&&t.classList.contains("popup")&&(document.removeEventListener("keydown",u),t.classList.remove(c))}var l={},d=function(t,e){t.disabled=e,e?t.classList.add(l.inactiveButtonClass):t.classList.remove(l.inactiveButtonClass)},p=function(t,e){d(e,function(t){return t.some((function(t){return!t.validity.valid}))}(t))},f=function(t,e){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(l.inputErrorClass),n.classList.remove(l.errorClass),n.textContent=""};function m(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.formSelector,t.inputSelector,t.submitButtonSelector,t.inactiveButtonClass,t.inputErrorClass,t.errorClass,l=arguments[0],Array.from(document.querySelectorAll("".concat(l.formSelector,":has(").concat(l.inputSelector,")"))).forEach((function(t){!function(t){var e=Array.from(t.querySelectorAll(l.inputSelector)),n=t.querySelector(l.submitButtonSelector);p(e,n),e.forEach((function(r){r.addEventListener("input",(function(){(function(t,e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?f(t,e):function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(l.inputErrorClass),r.classList.add(l.errorClass),r.textContent=n}(t,e,e.validationMessage)})(t,r),p(e,n)}))}))}(t)}))}function y(t){Array.from(t.querySelectorAll(l.inputSelector)).forEach((function(e){return f(t,e)}));var e=t.querySelector(l.submitButtonSelector);d(e,!0)}function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function h(t,e,n){return(e=function(t){var e=function(t){if("object"!=v(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==v(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var b="https://nomoreparties.co/v1/wff-cohort-35/",S="daac000b-c031-49fc-9356-0394a8a42db9",g=function(t){var e=t.url,n=t.method,r=void 0===n?"GET":n,o=t.headers,i=void 0===o?{}:o,c=t.body,a=void 0===c?null:c;return fetch(e,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){h(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({method:r,headers:i},a&&{body:JSON.stringify(a)}))},L=function(t){var e=t.endURL,n=t.method,r=t.headers,o=void 0===r?{}:r,i=t.body;return o.authorization=S,g({url:b+e,method:n,headers:o,body:i}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))},k=function(t){return g({url:t,method:"HEAD",mode:"cors",cache:"no-cache"})},E=new r,q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},C=document.querySelector(".places__list"),j=document.querySelector(".popup.popup_type_edit"),w=document.querySelector(".popup.popup_type_new-card"),P=document.querySelector(".popup.popup_type_image"),O=document.querySelector(".popup_type_avatar"),A=document.querySelector(".popup_confirm-del-card"),T=document.querySelector(".profile__edit-button"),D=document.querySelector(".profile__add-button"),x=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),U=document.querySelector(".profile__image"),I=P.querySelector("img.popup__image"),R=P.querySelector(".popup__caption"),M=j.querySelector("input.popup__input_type_name"),H=j.querySelector("input.popup__input_type_description"),z=O.querySelector("input.popup__input_type_avatar");function N(t){!function(t){t.name&&t.link&&I&&(I.src=t.link,I.alt=t.name,R&&(R.textContent=t.name))}(t),P&&a(P)}function V(t,e){document.forms[t]&&document.forms[t].addEventListener("submit",e)}function W(t){if(t){var e=t.querySelector('button[type="submit"].button.popup__button');e&&("Сохранить"===e.textContent.trim()?e.textContent="Сохранение...":e.textContent="Сохранить")}}function G(t){if(t){var e=t.elements,n={};if(Array.from(e).filter((function(t){return!!t.name})).forEach((function(t){var e=t.name,r=t.value;n[e]=r})),0!==Object.keys(n).length)return n}}function J(t){document.forms["confirm-del-card"]&&(document.forms["confirm-del-card"].dataset.cardId=t,a(A))}function F(t,e){return function(t,e){return L({endURL:"cards/likes/".concat(t),method:e?"PUT":"DELETE"})}(t,e).then((function(t){if(t.likes&&Array.isArray(t.likes))return Promise.resolve(t.likes.length)})).catch((function(t){return Promise.reject(t)}))}T&&T.addEventListener("click",(function(){j&&(x&&M&&(M.value=x.textContent),B&&H&&(H.value=B.textContent),a(j),y(j.querySelector(".popup__form")))})),D&&D.addEventListener("click",(function(){w&&(document.forms["new-place"].reset(),a(w),y(w.querySelector(".popup__form")))})),U&&(U.addEventListener("mouseenter",(function(){U.classList.add("avatar-edit_active")})),U.addEventListener("mouseleave",(function(){U.classList.remove("avatar-edit_active")})),U.addEventListener("click",(function(){U.classList.contains("avatar-edit_active")&&O&&(function(){if(U&&z){var t=U.style.backgroundImage.match(/url\(["']?([^"')]+)["']?\)/),e=t?t[1]:null;e&&(z.value=e)}}(),a(O),y(O.querySelector(".popup__form")))}))),document.querySelectorAll(".popup").forEach((function(t){!function(t){if(t&&t.classList.contains("popup")){t.classList.contains("popup_is-animated")||t.classList.add("popup_is-animated");var e=t.querySelector("button.popup__close");e&&e.addEventListener("click",(function(){s(t)})),t.addEventListener("mousedown",(function(e){e.target.closest(".popup__content")||s(t)}))}}(t)})),V("edit-profile",(function(t){t.preventDefault(),W(j);var e,n=G(t.target);n?(e=n,L({endURL:"users/me",method:"PATCH",headers:{"Content-Type":"application/json"},body:e})).then((function(t){K(t),s(j)})).catch((function(t){console.log(t)})).finally((function(){W(j)})):s(j)})),V("new-place",(function(t){t.preventDefault(),W(w);var e=G(t.target);e?function(t){if(t.name&&t.link)return k(t.link).then((function(e){if(!e.ok)return Promise.reject(e.status);var n=e.headers.get("Content-Type");return n&&n.startsWith("image/")?L({endURL:"cards",method:"POST",headers:{"Content-Type":"application/json"},body:t}).then((function(t){return t})):Promise.reject("ссылка не на картинку")}))}({name:e["place-name"],link:e.link}).then((function(t){if(t){var e=i(t,E._id,{onShow:N,onDelete:J,onLike:F});e&&C&&C.prepend(e),s(w)}})).catch((function(t){console.log("Ошибка сохранения карточки:",t)})).finally((function(){W(w)})):s(w)})),V("edit-avatar",(function(t){t.preventDefault(),W(O);var e=G(t.target);if(e&&e.link){var n=e.link;n?k(n).then((function(t){if(!t.ok)return Promise.reject(t.status);var e=t.headers.get("Content-Type");return e&&e.startsWith("image/")?L({endURL:"users/me/avatar",method:"PATCH",headers:{"Content-Type":"application/json"},body:{avatar:n}}):Promise.reject("ссылка не на картинку")})).then((function(t){K(t),s(O)})).catch((function(t){console.log("Ошибка обновления аватар:",t)})).finally((function(){W(O)})):s(O)}else s(O)})),V("confirm-del-card",(function(t){if(t.preventDefault(),"cardId"in t.target.dataset){var e=t.target.dataset.cardId;(function(t){return g({url:"".concat(b,"cards/").concat(t),method:"DELETE",headers:{authorization:S}})})(e).then((function(t){if(!t.ok)return Promise.reject(t.status);s(A),function(t){var e=document.querySelector('.places__item.card[data-card-id="'.concat(t,'"]'));e&&(e.remove(),function(){throw new TypeError('"card" is read-only')}())}(e)})).catch((function(t){console.log("Ошибка удаления карточки:",t)})),delete t.target.dataset.cardId}else s(A)}));var K=function(t){var e=t.name,n=t.about,r=t.avatar;x&&e&&(x.textContent=e),B&&n&&(B.textContent=n),U&&r&&(U.style.backgroundImage='url("'.concat(r,'")'))};document.addEventListener("DOMContentLoaded",(function(){m(q),Promise.all([L({endURL:"users/me"}),L({endURL:"cards"})]).then((function(t){var e;t[0]&&(E.data=t[0],K(t[0])),t[1]&&Array.isArray(t[1])&&t[1].length>0&&(e=C,t[1].forEach((function(t){var n=i(t,E._id,{onShow:N,onDelete:J,onLike:F});n&&e.append(n)})))})).catch((function(t){console.log(t)}))}))})();
//# sourceMappingURL=main.js.map